/* 
mzMl v1.0.0
A collection of TypeScript-based ML helpers.
https://github.com/mzusin/mz-ml
Copyright (c) 2023-present, Miriam Zusin          
*/
var d=Object.defineProperty,x=Object.defineProperties,V=Object.getOwnPropertyDescriptor,M=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=Math.pow,p=(s,t,e)=>t in s?d(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,O=(s,t)=>{for(var e in t||(t={}))v.call(t,e)&&p(s,e,t[e]);if(w)for(var e of w(t))D.call(t,e)&&p(s,e,t[e]);return s},I=(s,t)=>x(s,M(t));var E=(s,t)=>{for(var e in t)d(s,e,{get:t[e],enumerable:!0})},N=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of R(t))!v.call(s,r)&&r!==e&&d(s,r,{get:()=>t[r],enumerable:!(i=V(t,r))||i.enumerable});return s};var y=s=>N(d({},"__esModule",{value:!0}),s);var u=(s,t,e)=>(p(s,typeof t!="symbol"?t+"":t,e),e);var q={};E(q,{LinearRegression:()=>c,SimpleLinearRegression:()=>g,splitData:()=>C});module.exports=y(q);var c=class{constructor(t){u(this,"options");u(this,"weights");u(this,"bias");u(this,"features");u(this,"labels");u(this,"featuresSize");u(this,"batchSize");u(this,"pearson",()=>{if(this.features.length<=0||this.labels.length<=0)return[];let t=[],e=this.labels.reduce((i,r)=>i+r,0)/this.labels.length;for(let i=0;i<this.featuresSize;i++){let r=0,n=0,o=0,a=this.features.map(l=>l[i]),h=a.reduce((l,f)=>l+f,0)/a.length;for(let l=0;l<this.features.length;l++){let f=this.features[l][i],b=this.labels[l];r+=(f-h)*(b-e),n+=S(f-h,2),o+=S(b-e,2)}t.push(n===0||o===0?0:r/Math.sqrt(n*o))}return t});var e;if(this.options=t,this.features=JSON.parse(JSON.stringify(this.options.features)),this.labels=JSON.parse(JSON.stringify(this.options.labels)),this.featuresSize=this.features.length>0?this.features[0].length:0,!this.validateInput())throw new Error("The input is not valid. Number of features should match the number of labels, and all features should have the same size.");this.weights=c.initZeroArray(this.featuresSize),this.bias=0,this.batchSize=(e=this.options.batchSize)!=null?e:this.features.length}validateInput(){if(this.features.length<=0||this.features.length!==this.labels.length)return!1;let t=this.features[0].length;for(let e of this.features)if(e.length!==t)return!1;return!0}static initZeroArray(t){let e=[];return e.length=t,e.fill(0),e}shuffle(){let t=[];for(let e=0;e<this.featuresSize;e++)t.push(e);for(let e=this.features.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}for(let e=this.features.length-1;e>0;e--)[this.features[e],this.features[t[e]]]=[this.features[t[e]],this.features[e]],[this.labels[e],this.labels[t[e]]]=[this.labels[t[e]],this.labels[e]]}gradientDescent(t,e){let i=c.initZeroArray(this.featuresSize),r=0;for(let a=0;a<t.length;a++){let h=t[a],l=e[a],f=this.predict(h),b=l-f;for(let m=0;m<this.featuresSize;m++)i[m]+=-2*h[m]*b;r+=-2*b}let n=[];for(let a=0;a<this.weights.length;a++){let l=this.weights[a]-this.options.learningRate/this.batchSize*i[a];n.push(l)}let o=this.bias-this.options.learningRate/this.batchSize*r;return[n,o]}fit(){let t=performance.now();for(let e=0;e<this.options.epochs;e++){this.options.shuffle&&this.shuffle();for(let i=0;i<this.features.length;i+=this.batchSize){let r=this.features.slice(i,i+this.batchSize),n=this.labels.slice(i,i+this.batchSize),[o,a]=this.gradientDescent(r,n);if(typeof this.options.epochsCallback=="function"){let h=performance.now();this.options.epochsCallback({epoch:e,epochsCount:this.options.epochs,newWeights:o,newBias:a,time:h-t})}this.weights=o,this.bias=a}}return[this.weights,this.bias]}predict(t,e){if(t.length!==this.weights.length)throw new Error("Number of features does not match the number of weights.");let i=performance.now(),r=this.bias;for(let n=0;n<t.length;n++)r+=t[n]*this.weights[n];return e&&console.log(`Prediction = ${r}, ${performance.now()-i} ms`),r}predictBatch(t,e){let i=[],r=performance.now();for(let n of t)i.push(this.predict(n));return e&&console.log(`Predictions = ${i}, ${performance.now()-r} ms`),i}rSquared(){let t=0,e=0,i=this.labels.length<=0?0:this.labels.reduce((r,n)=>r+n)/this.labels.length;for(let r=0;r<this.features.length;r++){let n=this.labels[r],o=this.predict(this.features[r]);t+=S(n-o,2),e+=S(n-i,2)}return 1-t/e}meanSquaredError(){if(this.features.length<=0)return 0;let t=0;for(let e=0;e<this.features.length;e++){let i=this.labels[e],r=this.predict(this.features[e]);t+=S(i-r,2)}return t/=this.features.length,t}};var g=class extends c{constructor(t){let e=[];for(let r of t.features)e.push([r]);let i=I(O({},t),{features:e});super(i)}};var C=s=>{var z;let t=s.features.length;if(t<=0||t!==s.labels.length)throw new Error("Number of features does not match the number of labels.");if(s.testSetSize<0||s.testSetSize>1)throw new Error("testSetSize should be in the range (0, 1).");if(s.validationSetSize!==void 0){if(s.validationSetSize<0||s.validationSetSize>1)throw new Error("validationSetSize should be in the range (0, 1).");if(s.validationSetSize+s.testSetSize>1)throw new Error("Sum of testSetSize and validationSetSize should not exceed 1.")}let e=(z=s.validationSetSize)!=null?z:0,i=s.testSetSize,r=Math.round(t*e),n=Math.round(t*i),o=t-r-n,a=s.features.slice(0,o),h=s.labels.slice(0,o),l=o+n,f=s.features.slice(o,l),b=s.labels.slice(o,l),m=r<=0?[]:s.features.slice(l),T=r<=0?[]:s.labels.slice(l);return{featuresTrain:a,featuresTest:f,featuresValidation:m,labelsTrain:h,labelsTest:b,labelsValidation:T}};0&&(module.exports={LinearRegression,SimpleLinearRegression,splitData});
//# sourceMappingURL=mz-ml.node.cjs.map
